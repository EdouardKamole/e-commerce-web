(function(n){var p=window.AmazonUIPageJS||window.P,m=p._namespace||p.attributeErrors,l=m?m("AmazonLightsaberPageAssets",""):p;l.guardFatal?l.guardFatal(n)(l,window):l.execute(function(){n(l,window)})})(function(n,p,m){(function(){var l;(function(c){c.deep=function(a){return JSON.parse(JSON.stringify(a))}})(l||(l={}));var x;(function(c){c.log=function(a){for(var b=1;b<arguments.length;b++);}})(x||(x={}));var q;(function(c){c.isObject=function(a){return!!a&&"object"===typeof a&&!Array.isArray(a)};c.isNonEmptyString=
function(a){return"string"===typeof a&&0<a.length};c.isPositiveInteger=function(a){return"number"===typeof a&&Math.floor(a)===a&&0<=a&&Infinity!==a};c.isFunction=function(a){return"function"===typeof a}})(q||(q={}));var B=this&&this.__awaiter||function(c,a,b,f){function d(a){return a instanceof b?a:new b(function(b){b(a)})}return new (b||(b=Promise))(function(b,g){function e(a){try{r(f.next(a))}catch(t){g(t)}}function h(a){try{r(f["throw"](a))}catch(t){g(t)}}function r(a){a.done?b(a.value):d(a.value).then(e,
h)}r((f=f.apply(c,a||[])).next())})},C=this&&this.__generator||function(c,a){function b(a){return function(b){return f([a,b])}}function f(b){if(h)throw new TypeError("Generator is already executing.");for(;d;)try{if(h=1,g&&(e=b[0]&2?g["return"]:b[0]?g["throw"]||((e=g["return"])&&e.call(g),0):g.next)&&!(e=e.call(g,b[1])).done)return e;if(g=0,e)b=[b[0]&2,e.value];switch(b[0]){case 0:case 1:e=b;break;case 4:return d.label++,{value:b[1],done:!1};case 5:d.label++;g=b[1];b=[0];continue;case 7:b=d.ops.pop();
d.trys.pop();continue;default:if(!(e=d.trys,e=0<e.length&&e[e.length-1])&&(6===b[0]||2===b[0])){d=0;continue}if(3===b[0]&&(!e||b[1]>e[0]&&b[1]<e[3]))d.label=b[1];else if(6===b[0]&&d.label<e[1])d.label=e[1],e=b;else if(e&&d.label<e[2])d.label=e[2],d.ops.push(b);else{e[2]&&d.ops.pop();d.trys.pop();continue}}b=a.call(c,d)}catch(y){b=[6,y],g=0}finally{h=e=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}var d={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,
e,k;return k={next:b(0),"throw":b(1),"return":b(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k},w;(function(c){var a=this;c.queueTask=function(a,c){return setTimeout(a,c||0)};c.queueTaskEvery=function(a,c){return setInterval(a,c)};c.wait=function(b){return B(a,void 0,void 0,function(){return C(this,function(a){return[2,new Promise(function(a){setTimeout(a,b)})]})})};c.queueMicrotask=function(a){Promise.resolve().then(function(){a()})};c.waitTillIdleOrTimeout=function(b){return B(a,
void 0,void 0,function(){return C(this,function(a){return[2,new Promise(function(a){self.requestIdleCallback?self.requestIdleCallback(function(b){a(b)},{timeout:b}):setTimeout(function(){a({didTimeout:!0,timeRemaining:function(){return 0}})},b)})]})})}})(w||(w={}));var D=function(){function c(a){this._global=a;var b=q.isFunction;this._unsupported=!a.ue||!b(a.ue.tag)||!b(a.ue.count)||!b(a.uet)||!b(a.uex)}c.prototype.tag=function(a){this._unsupported||(a=this._getMetricName(a),this._global.ue.tag(a),
this._global.ue.isl&&this._global.uex("at"))};c.prototype.count=function(a,b){void 0===b&&(b=1);this._unsupported||(a=this._getMetricName(a),this._global.ue.count(a,b))};c.prototype.widgetLatency=function(a,b,c){b=this._getMetricName(b);"ld"===a?this._global.uex(a,b,{wb:1},c):this._global.uet(a,b,{wb:1},c)};c.prototype._getMetricName=function(a){return(c._METRIC_PREFIX+":"+a).toLowerCase()};c._METRIC_PREFIX="Lightsaber:Page";return c}(),E={"gateway-phone-apps":"HomePage","gateway-phone-web":"HomePage",
Gateway:"HomePage",SearchAW:"Search",Search:"Search",DetailWebView:"Detail",WebflowDetailWebView:"Detail",DetailAW:"Detail",WebflowDetailAW:"Detail",Detail:"Detail",WebflowDetail:"Detail",ShoppingCartWebview:"Cart",ShoppingCartAW:"Cart",ShoppingCart:"Cart",CheckoutConfirmOrderWebview:"Checkout",CheckoutConfirmOrderAW:"Checkout",CheckoutConfirmOrder:"Checkout"},u;(function(c){c.getPageType=function(a){return a.ue_pty||"unknown"};c.getSubPageType=function(a){return a.ue_spty||"unknown"};c.getRequestId=
function(a){return a.ue_id};c.getPageTypeGroup=function(a){a=c.getPageType(a);return(a=E[a])?a:"Unknown"}})(u||(u={}));var v=function(){function c(a,b,c){this.global=a;this._csmLogger=c;this._workerMessaging=b}c.prototype.getAbsoluteUrl=function(a){return(new URL(a,this.global.location.href)).href};c.prototype.ready=function(){return this._workerMessaging.ready()};c.prototype.sendToWorker=function(a){this._workerMessaging.send(c._RENDERING_HINTS_COMMAND,a)};c.prototype.logCount=function(a,b){this._csmLogger.count("RenderingHints:Collect:"+
a,b)};c._RENDERING_HINTS_COMMAND="rendering_hints";return c}(),F=this&&this.__extends||function(){var c=function(a,b){c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return c(a,b)};return function(a,b){function f(){this.constructor=a}c(a,b);a.prototype=null===b?Object.create(b):(f.prototype=b.prototype,new f)}}(),G=this&&this.__awaiter||function(c,a,b,f){function d(a){return a instanceof b?a:new b(function(b){b(a)})}
return new (b||(b=Promise))(function(b,g){function e(a){try{r(f.next(a))}catch(t){g(t)}}function h(a){try{r(f["throw"](a))}catch(t){g(t)}}function r(a){a.done?b(a.value):d(a.value).then(e,h)}r((f=f.apply(c,a||[])).next())})},H=this&&this.__generator||function(c,a){function b(a){return function(b){return f([a,b])}}function f(b){if(h)throw new TypeError("Generator is already executing.");for(;d;)try{if(h=1,g&&(e=b[0]&2?g["return"]:b[0]?g["throw"]||((e=g["return"])&&e.call(g),0):g.next)&&!(e=e.call(g,
b[1])).done)return e;if(g=0,e)b=[b[0]&2,e.value];switch(b[0]){case 0:case 1:e=b;break;case 4:return d.label++,{value:b[1],done:!1};case 5:d.label++;g=b[1];b=[0];continue;case 7:b=d.ops.pop();d.trys.pop();continue;default:if(!(e=d.trys,e=0<e.length&&e[e.length-1])&&(6===b[0]||2===b[0])){d=0;continue}if(3===b[0]&&(!e||b[1]>e[0]&&b[1]<e[3]))d.label=b[1];else if(6===b[0]&&d.label<e[1])d.label=e[1],e=b;else if(e&&d.label<e[2])d.label=e[2],d.ops.push(b);else{e[2]&&d.ops.pop();d.trys.pop();continue}}b=a.call(c,
d)}catch(y){b=[6,y],g=0}finally{h=e=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}var d={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},h,g,e,k;return k={next:b(0),"throw":b(1),"return":b(2)},"function"===typeof Symbol&&(k[Symbol.iterator]=function(){return this}),k};v=function(c){function a(a,f,d,h){f=c.call(this,a,f,d)||this;f._queryRoot=h||a.document;return f}F(a,c);a.prototype.trigger=function(){var b=this;w.queueTask(function(){return G(b,void 0,void 0,
function(){var b;return H(this,function(c){switch(c.label){case 0:return[4,w.waitTillIdleOrTimeout(a._IDLE_TIMEOUT)];case 1:c.sent();if(!this.ready())return this.logCount("NotReady"),[2];b=this.collect(this._queryRoot);this._send(b);return[2]}})})})};a.prototype._send=function(b){var c=this,d=Object.keys(b).map(function(d){return{nature:a._RENDERING_HINTS_NATURE,target:d,data:b[d],source:c._getSource()}});this.logCount("Targets",d.length);1>d.length||this.sendToWorker(d)};a.prototype._getSource=function(){return{url:this.global.location.href,
pty:u.getPageType(this.global),spty:u.getSubPageType(this.global),rid:u.getRequestId(this.global)}};a._IDLE_TIMEOUT=1E3;a._RENDERING_HINTS_NATURE="speculated_navigation_content";return a}(v);var I=this&&this.__extends||function(){var c=function(a,b){c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return c(a,b)};return function(a,b){function f(){this.constructor=a}c(a,b);a.prototype=null===b?Object.create(b):
(f.prototype=b.prototype,new f)}}(),z=this&&this.__assign||function(){z=Object.assign||function(c){for(var a,b=1,f=arguments.length;b<f;b++){a=arguments[b];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d])}return c};return z.apply(this,arguments)},A=function(c){function a(b,f,d,h,g,e){void 0===g&&(g=!1);void 0===e&&(e=a.POLLING_FREQUENCY);var k=c.call(this,b,f,d,h)||this;b.addEventListener(a.UPDATE_NOTIFICATION_EVENT,function(){k.trigger()});g&&w.queueTaskEvery(function(){k.trigger()},
e);k.trigger();return k}I(a,c);a.update=function(b){var c=new CustomEvent(a.UPDATE_NOTIFICATION_EVENT,{bubbles:!1,cancelable:!1});b.dispatchEvent(c)};a.prototype.collect=function(b){var c=b.querySelectorAll(a.QUERY_SELECTOR),d={};b=function(b){b=c[b];var f=z({},b.dataset),e=f[a.ATTR_TARGET];b.classList.remove(a.RENDERING_HINTS_CLASS);if(!e)return"continue";var g=h.getAbsoluteUrl(e);d[g]=d[g]||{};Object.keys(f).filter(function(b){return!!f[b]&&b!==a.ATTR_QUERY&&b!==a.ATTR_TARGET}).forEach(function(a){d[g][a]=
f[a]})};for(var h=this,g=0;g<c.length;g++)b(g);return d};a.prototype.logCount=function(a,f){c.prototype.logCount.call(this,"DDHC:"+a,f)};a.RENDERING_HINTS_CLASS="lightsaber-rendering-hints";a.QUERY_SELECTOR='div[data-lightsaber\x3d"rendering-hints/speculated-navigation-content"].'+a.RENDERING_HINTS_CLASS;a.ATTR_QUERY="lightsaber";a.ATTR_TARGET="target";a.UPDATE_NOTIFICATION_EVENT="lightsaber:rendering-hints:declarative-dataset:update";a.POLLING_FREQUENCY=3E3;return a}(v),J=this&&this.__extends||function(){var c=
function(a,b){c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return c(a,b)};return function(a,b){function f(){this.constructor=a}c(a,b);a.prototype=null===b?Object.create(b):(f.prototype=b.prototype,new f)}}(),K=function(c){function a(a,f,d,h,g,e){var b=c.call(this,a,f,d,e)||this;if(!g.capabilities.mobile)return b;h.when("Rush","s-web-application-controller").execute(function(c,d){c.on(d.ACTIONS.LOAD_SEARCH_PAGE_COMPLETE,
function(){b.trigger();A.update(a)})});b._previouslySeenTargets={};b.trigger();return b}J(a,c);a.prototype.collect=function(b){b=b.querySelectorAll(a.FACEOUT_IMAGE_QUERY);for(var c={},d=0;d<b.length;d++){var h=b[d],g=h.closest("a");g&&(g=g.href,this._previouslySeenTargets[g]||(this._previouslySeenTargets[g]=!0,c[g]={faceoutImage:h.src,productTitle:h.alt}))}this.logCount("Query",Object.keys(c).length);return c};a.prototype.logCount=function(a,f){c.prototype.logCount.call(this,"SPHC:"+a,f)};a.FACEOUT_IMAGE_QUERY=
'a.s-faceout-link img.s-image[data-image-latency\x3d"s-product-image"]';return a}(v);v=function(){function c(a,b,c,d){var f=this;this.global=a;this.csmLogger=b;this.P=c;this.A=d;"complete"===a.document.readyState?this.survey():a.addEventListener("load",function(){f.survey()})}c.prototype.getResourceTimingRecords=function(a){var b=this.global.performance.getEntriesByType("resource");return"function"===typeof a?b.filter(a):b};c.prototype.getServerTimingRecords=function(){var a=this.global.performance.getEntriesByType("navigation")[0];
return a&&a.serverTiming?a.serverTiming.filter(function(a){return a.name===c._SERVER_TIMING_NAME}).map(function(a){if(a.description)try{return JSON.parse(decodeURIComponent(a.description))}catch(f){}}).filter(function(a){return!!a}):[]};c.prototype.getEpochForPerformanceTimeline=function(a){return Math.round(this.global.performance.timeOrigin+a)};c.prototype.logTag=function(a){this.csmLogger.tag(this._getMetricName(a))};c.prototype.logCount=function(a,b){this.csmLogger.count(this._getMetricName(a),
b)};c.prototype.logWidgetLatency=function(a,b,c){b=this._getMetricName(b);this.csmLogger.widgetLatency(a,b,c)};c.prototype._getMetricName=function(a){return"RenderingHints:Survey:"+a};c._SERVER_TIMING_NAME="lightsaber";return c}();var L=this&&this.__extends||function(){var c=function(a,b){c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return c(a,b)};return function(a,b){function f(){this.constructor=
a}c(a,b);a.prototype=null===b?Object.create(b):(f.prototype=b.prototype,new f)}}(),M=function(c){function a(){return null!==c&&c.apply(this,arguments)||this}L(a,c);a.prototype.survey=function(){var a=this._getLandingImageUrl();if(a){var c=this._getPreloadedUrlRecord();c?this._logMatch(a,c.href,c.attribution):this._logCount("HintNotFound",1)}else this._logCount("NoLandingImage",1)};a.prototype._getLandingImageUrl=function(){var b=this.A.state(this.A.capabilities.mobile?a._MOBILE_PAGE_STATE:a._DESKTOP_PAGE_STATE);
return b&&b.landingImageUrl?b.landingImageUrl:m};a.prototype._getPreloadedUrlRecord=function(){var b=this.getServerTimingRecords().filter(function(b){return b.role===a._RECORD_ROLE&&b.purpose===a._RECORD_PURPOSE&&b.as===a._RECORD_AS});return 0<b.length?b[0]:m};a.prototype._logMatch=function(a,c,d){a=this._hitOrMiss(c===a);this._logCount(a,1);d&&this._logCount(a+":"+d,1)};a.prototype._logCount=function(b,c){this.logCount(a._METRIC_PREFIX+":"+b,c)};a.prototype._hitOrMiss=function(a){return a?"Hit":
"Miss"};a._RECORD_ROLE="rendering-hints/preload";a._RECORD_PURPOSE="detail-landing-image";a._RECORD_AS="image";a._METRIC_PREFIX="DetailLandingImagePreload";a._MOBILE_PAGE_STATE="mobile-landing-image-data";a._DESKTOP_PAGE_STATE="desktop-landing-image-data";return a}(v),N=function(){function c(a,b,c,d,h){this._global=a;this._P=b;this._A=c;this._workerMessaging=d;this._csmLogger=h}c.prototype.start=function(){switch(u.getPageTypeGroup(this._global)){case "Search":var a=document.getElementById("search");
new A(this._global,this._workerMessaging,this._csmLogger,a);new K(this._global,this._workerMessaging,this._csmLogger,this._P,this._A,a);break;case "Detail":a=document.getElementById("dp"),new A(this._global,this._workerMessaging,this._csmLogger,a),new M(this._global,this._csmLogger,this._P,this._A)}};return c}();(function(){function c(a){this._hit=!(!a.$Lightsaber||!a.$Lightsaber.hit);try{var b=a.$Lightsaber&&a.$Lightsaber.meta?l.deep(a.$Lightsaber.meta):m;this._meta=this._isValid(b)?b:m}catch(f){this._meta=
m}}c.prototype.isHit=function(){return this._hit};c.prototype.getMeta=function(){return this._meta};c.prototype._isValid=function(a){var b=q.isObject,c=q.isNonEmptyString,d=q.isPositiveInteger;return!!(a&&b(a)&&d(a.fetchEventTimeOrigin)&&c(a.navigationRule)&&b(a.responseStrategy)&&c(a.responseStrategy.name)&&b(a.clientLib)&&c(a.clientLib.version))};return c})();var O=function(){function c(a){this._global=a}c.prototype.send=function(a,b){a={feature:c.FEATURE,command:a,options:b};(b=this._getCurrentController())?
(x.log("ServiceWorker:PostMessage:",a),b.postMessage(a)):x.log("ServiceWorker:Unavailable:",a)};c.prototype.ready=function(){return!!this._getCurrentController()};c.prototype._getCurrentController=function(){if(this._global&&this._global.navigator&&this._global.navigator.serviceWorker&&this._global.navigator.serviceWorker.controller&&q.isFunction(this._global.navigator.serviceWorker.controller.postMessage))return this._global.navigator.serviceWorker.controller};c.FEATURE="lightsaber";return c}();
(function(){n.when("A").execute("lightsaber:page",function(c){var a=new D(p),b=new O(p);a.count("AssetLoaded");n.now().register("lightsaber:page:rendering-metrics",function(){});n.when("ready").register("lightsaber:page:rendering-hints",function(){(new N(p,n,c,b,a)).start()})})})()})()});